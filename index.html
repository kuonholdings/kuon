<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>KUON</title>
  <meta name="description" content="KUON" />
  <meta name="theme-color" content="#ffffff" />

  <style>
    :root{
      --bg:#ffffff;
      --fg:#111;

      --baseline:54vh;
      --clock-gap:22px;
      --contact-gap:62px;

      --panel-gap:16px;
      --panel-stack-gap:14px;
      --langs-gap:22px;

      --muted-1: rgba(0,0,0,0.66);
      --muted-2: rgba(0,0,0,0.70);
      --muted-3: rgba(0,0,0,0.58);

      --pad-x:64px;
      --pad-y:56px;

      /* Japanese editorial crop marks */
      --mark: rgba(0,0,0,0.18);
      --mark-h: 1px;
      --mark-l: 22px;
      --mark-gap: 18px;

      --logo-size:56px;
      --logo-track:0.28em;
      --logo-pad:0.22em;

      --clock-size:18px;
      --clock-tone: rgba(0,0,0,0.14);

      /* cycling underline */
      --cycle-ms: 12000ms;
      --cycle-line: rgba(0,0,0,0.28);
      --cycle-line-h: 1px;
      --cycle-underline-gap: 2px;

      /* curtain swap */
      --swap-ms: 1700ms;
      --swap-ease: cubic-bezier(.35,0,.25,1);
      --swap-inset-y: 6px;
      --swap-inset-x: 12px;

      /* clock soft fade */
      --clockfade-ms: 900ms;
      --clockfade-ease: cubic-bezier(.35,0,.25,1);

      /* fixed line boxes (prevents vertical metric shift across scripts) */
      --logo-line-h: calc(var(--logo-size) * 1.08);
      --contact-font: 11px;
      --contact-line-h: 18px;
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; }
    body{
      margin:0;
      background:var(--bg);
      color:var(--fg);
      overflow:hidden;
      font-family:-apple-system, BlinkMacSystemFont, "Helvetica Neue", Helvetica, Arial, sans-serif;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .wrap{
      height:100%;
      width:100%;
      padding:var(--pad-y) var(--pad-x);
      position:relative;
    }

    /* Corner crop marks */
    .crop{
      position:fixed;
      width:calc(var(--mark-l) + 2px);
      height:calc(var(--mark-l) + 2px);
      pointer-events:none;
      z-index:5;

      opacity:0.78;
      transition: opacity 300ms ease;
    }
    body:hover .crop{ opacity:1; }

    .crop::before, .crop::after{
      content:"";
      position:absolute;
      background:var(--mark);
    }
    .crop::before{ height:var(--mark-h); width:var(--mark-l); top:0; left:0; }
    .crop::after{ width:var(--mark-h); height:var(--mark-l); top:0; left:0; }

    .crop.tl{ top:var(--mark-gap); left:var(--mark-gap); }
    .crop.tr{ top:var(--mark-gap); right:var(--mark-gap); transform: scaleX(-1); }
    .crop.bl{ bottom:var(--mark-gap); left:var(--mark-gap); transform: scaleY(-1); }
    .crop.br{ bottom:var(--mark-gap); right:var(--mark-gap); transform: scale(-1); }

    .center{
      position:absolute;
      left:50%;
      top:var(--baseline);
      transform:translate(-50%, -50%);
      width:min(980px, calc(100% - 40px));
      text-align:center;
    }

    .hero{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:var(--clock-gap);
    }

    /* Curtain swap */
    .swapBox{
      position:relative;
      display:inline-flex;   /* important: allow centring within fixed-height boxes */
      align-items:center;
      justify-content:center;
    }
    .swapBox::before{
      content:"";
      position:absolute;
      inset:calc(-1 * var(--swap-inset-y)) calc(-1 * var(--swap-inset-x));
      background:var(--bg);
      opacity:0;
      pointer-events:none;
    }
    @keyframes curtain{
      0%   { opacity:0; }
      45%  { opacity:1; }
      55%  { opacity:1; }
      100% { opacity:0; }
    }
    .swapBox.is-swapping::before{
      animation: curtain var(--swap-ms) var(--swap-ease) both;
    }

    /* Fixed-height line boxes to prevent vertical shift across scripts */
    .logoBox{
      min-height: var(--logo-line-h);
      height: var(--logo-line-h);
    }
    .descBox{ min-height: 3.4em; } /* descriptor already stable */
    .contactLineBox{
      height: var(--contact-line-h);
      min-height: var(--contact-line-h);
    }

    .logo{
      margin:0;
      font-weight:700;
      letter-spacing:var(--logo-track);
      font-size:var(--logo-size);
      line-height:1;
      padding-left:var(--logo-pad);
      white-space:nowrap;
    }

    /* Clock soft crossfade */
    .clockX{
      display:grid;
      place-items:center;
    }
    .clockX .layer{
      grid-area:1/1;
      transition: opacity var(--clockfade-ms) var(--clockfade-ease);
      will-change: opacity;
    }
    .clockX .b{ opacity:0; }
    .clockX.is-b .a{ opacity:0; }
    .clockX.is-b .b{ opacity:1; }

    .clock{
      font-size:var(--clock-size);
      font-weight:500;
      letter-spacing:0.14em;
      color:var(--clock-tone);
      text-shadow:
        0 -1px 0 rgba(0,0,0,0.06),
        0  1px 1px rgba(255,255,255,0.60);
      font-variant-numeric: tabular-nums;
      font-feature-settings: "tnum" 1, "lnum" 1;
      white-space:nowrap;
      user-select:none;
      margin:0;
      line-height:1.15;
    }

    .contactRow{ margin-top:var(--contact-gap); }

    .contact{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      border:0;
      background:transparent;
      padding:6px 10px;
      cursor:pointer;

      color:rgba(0,0,0,0.62);
      font-weight:400;
      letter-spacing:0.24em;
      font-size:var(--contact-font);
      text-transform:uppercase;
    }
    .contact:hover{ color:var(--fg); }

    .contact:focus{ outline:none; }
    .contact:focus-visible{
      outline:2px solid rgba(0,0,0,0.18);
      outline-offset:6px;
      border-radius:10px;
    }

    /* Lock label width so it never reflows; no arrow now */
    #contactLabel{
      display:inline-block;
      width:8ch;          /* enough for “contact” comfortably */
      text-align:center;
      line-height:1;
      white-space:nowrap;
    }

    .panel{
      margin-top:var(--panel-gap);
      display:grid;
      gap:var(--panel-stack-gap);
      justify-items:center;
      width:min(560px, 100%);
      margin-left:auto;
      margin-right:auto;
      opacity:0;
      transform:translateY(6px);
      pointer-events:none;
      transition: opacity 260ms ease, transform 260ms ease;
    }
    .panel.is-open{
      opacity:1;
      transform:translateY(0);
      pointer-events:auto;
    }

    .descriptor{
      font-size:11px;
      letter-spacing:0.12em;
      color:var(--muted-1);
      max-width:58ch;
      line-height:1.7;
      text-align:center;
      margin:0;
    }

    .email{
      font-size:12px;
      letter-spacing:0.14em;
      text-transform:none;
      color:var(--muted-2);
      text-decoration:none;
      padding:4px 10px;
      transition: color 160ms ease;
    }
    .email:hover{ color:var(--fg); }

    .langs{
      margin-top:var(--langs-gap);
      display:flex;
      align-items:center;
      justify-content:center;
      gap:18px;
      flex-wrap:wrap;
    }

    .lang{
      background:transparent;
      border:0;
      padding:4px 2px;
      cursor:pointer;
      color:var(--muted-3);
      font-weight:400;
      letter-spacing:0.13em;
      font-size:11px;
      text-transform:uppercase;
      white-space:nowrap;
      position:relative;
      transition: color 160ms ease;
    }
    .lang:hover{ color:var(--fg); }
    .lang[aria-current="true"]{ color:rgba(0,0,0,0.78); }

    .lang:focus{ outline:none; }
    .lang:focus-visible{
      outline:1px solid rgba(0,0,0,0.18);
      outline-offset:4px;
      border-radius:6px;
    }

    .langs.is-cycling .lang[aria-current="true"]::after{
      content:"";
      position:absolute;
      left:0;
      right:0;
      height:var(--cycle-line-h);
      background:var(--cycle-line);
      bottom:calc(-1 * var(--cycle-underline-gap));
      transform-origin:left center;
      transform:scaleX(0);
      opacity:0.85;
      animation: langProgress var(--cycle-ms) linear forwards;
    }
    .langs.is-cycling[data-cycle-id] .lang[aria-current="true"]::after{
      animation-name: langProgress;
    }
    @keyframes langProgress{
      from { transform: scaleX(0); }
      to   { transform: scaleX(1); }
    }

    @media (prefers-reduced-motion: reduce){
      .swapBox.is-swapping::before{ animation:none; opacity:0; }
      .clockX .layer{ transition:none; }
      .langs.is-cycling .lang[aria-current="true"]::after{ animation:none; }
    }

    .bottom{
      position:fixed;
      left:0; right:0;
      bottom:var(--mark-gap);
      padding:0 var(--pad-x);
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap:24px;
      pointer-events:none;
    }
    .bottom .left,
    .bottom .right{
      font-size:11px;
      letter-spacing:0.14em;
      color:rgba(0,0,0,0.34);
      line-height:1.6;
      white-space:nowrap;
      text-transform:uppercase;
    }
    .bottom .right{ text-align:right; }

    @media (max-width: 720px){
      :root{
        --pad-x:22px;
        --pad-y:40px;
        --clock-size:16px;
        --logo-size:48px;
        --logo-track:0.27em;
        --logo-pad:0.20em;
        --mark-l: 18px;
        --mark-gap: 14px;
        --contact-line-h: 18px;
      }
      .bottom .left, .bottom .right{ white-space:normal; }
    }
  </style>
</head>

<body>
  <div class="crop tl" aria-hidden="true"></div>
  <div class="crop tr" aria-hidden="true"></div>
  <div class="crop bl" aria-hidden="true"></div>
  <div class="crop br" aria-hidden="true"></div>

  <div class="wrap">
    <main class="center" aria-label="KUON">

      <div class="hero">
        <div class="swapBox logoBox" id="logoSwap">
          <h1 class="logo" id="logoText">KUON</h1>
        </div>

        <div class="clockBox" aria-hidden="true">
          <div class="clockX" id="clockX">
            <div class="layer a"><div class="clock" id="clockA">—</div></div>
            <div class="layer b"><div class="clock" id="clockB">—</div></div>
          </div>
        </div>
      </div>

      <div class="contactRow">
        <button class="contact" id="contactBtn" type="button" aria-expanded="false" aria-controls="panel">
          <span class="swapBox contactLineBox" id="contactSwap">
            <span id="contactLabel">contact</span>
          </span>
        </button>

        <div class="panel" id="panel" aria-label="Contact panel">
          <div class="swapBox descBox" id="descSwap">
            <p class="descriptor" id="descText">
              KUON holds work intended to last — across design, sound, and structure.
            </p>
          </div>

          <a class="email" href="mailto:info@kuonholdings.com">info@kuonholdings.com</a>

          <div class="langs" id="langs" aria-label="Languages">
            <button class="lang" type="button" data-lang="en" aria-current="true">ENGLISH</button>
            <button class="lang" type="button" data-lang="ja">JAPANESE</button>
            <button class="lang" type="button" data-lang="zh">CHINESE</button>
          </div>
        </div>
      </div>
    </main>
  </div>

  <footer class="bottom" aria-label="Footer info">
    <div class="left">KUON HOLDINGS</div>
    <div class="right">TOKYO / LONDON</div>
  </footer>

  <script>
    const prefersReducedMotion =
      window.matchMedia && window.matchMedia("(prefers-reduced-motion: reduce)").matches;

    const CONTENT = {
      en: {
        htmlLang:"en", tz:"UTC", tzLabel:"UTC",
        logo:"KUON", contact:"contact", back:"back",
        desc:"KUON holds work intended to last — across design, sound, and structure."
      },
      ja: {
        htmlLang:"ja", tz:"Asia/Tokyo", tzLabel:"JPN",
        logo:"クオン", contact:"連絡", back:"戻る",
        desc:"KUONは、長く残ることを意図した仕事を保有します――デザイン、音、構造にわたって。"
      },
      zh: {
        htmlLang:"zh", tz:"Asia/Shanghai", tzLabel:"CHN",
        logo:"久音", contact:"联系", back:"返回",
        desc:"KUON 持有旨在长久延续的工作——涵盖设计、声音与结构。"
      }
    };

    const ORDER = ["en","ja","zh"];
    let currentLang = "en";

    const CYCLE_MS = 12000;
    const MANUAL_PAUSE_MS = 30000;
    document.documentElement.style.setProperty("--cycle-ms", `${CYCLE_MS}ms`);

    const SWAP_TOTAL_MS = 1700;              // must match CSS --swap-ms
    const SWAP_AT_MS = Math.round(SWAP_TOTAL_MS * 0.50);

    const logoSwap = document.getElementById("logoSwap");
    const clockX = document.getElementById("clockX");
    const clockA = document.getElementById("clockA");
    const clockB = document.getElementById("clockB");
    const contactSwap = document.getElementById("contactSwap");
    const descSwap = document.getElementById("descSwap");

    const logoText = document.getElementById("logoText");
    const contactLabel = document.getElementById("contactLabel");
    const contactBtn = document.getElementById("contactBtn");
    const panel = document.getElementById("panel");
    const descText = document.getElementById("descText");

    const langsEl = document.getElementById("langs");
    const langButtons = Array.from(document.querySelectorAll(".lang"));

    let cycleTimer = null;
    let resumeTimer = null;
    let cycleId = 0;
    let open = false;

    function partsForTZ(date, timeZone){
      const fmt = new Intl.DateTimeFormat("en-GB", {
        timeZone,
        year:"numeric", month:"2-digit", day:"2-digit",
        hour:"2-digit", minute:"2-digit",
        hour12:false
      });
      const parts = fmt.formatToParts(date);
      const get = (t) => parts.find(p => p.type === t)?.value || "";
      return { Y:get("year"), M:get("month"), D:get("day"), h:get("hour"), m:get("minute") };
    }
    function formatInTZ(date, langKey){
      const { tz, tzLabel } = CONTENT[langKey];
      const p = partsForTZ(date, tz);
      return `${p.Y}.${p.M}.${p.D} ${p.h}:${p.m} ${tzLabel}`;
    }

    function setActiveButton(langKey){
      langButtons.forEach(b => b.removeAttribute("aria-current"));
      const btn = langButtons.find(b => b.dataset.lang === langKey);
      if (btn) btn.setAttribute("aria-current","true");
    }

    function restartUnderline(){
      cycleId += 1;
      langsEl.dataset.cycleId = String(cycleId);
      langsEl.classList.add("is-cycling");
      void langsEl.offsetWidth;
      langsEl.classList.add("is-cycling");
    }

    function startCurtain(box){
      box.classList.remove("is-swapping");
      void box.offsetWidth;
      box.classList.add("is-swapping");
    }
    function stopCurtain(box){
      box.classList.remove("is-swapping");
    }

    function curtainSwap(boxes, applyNewContent){
      if (prefersReducedMotion){
        applyNewContent();
        return;
      }
      boxes.forEach(startCurtain);
      setTimeout(applyNewContent, SWAP_AT_MS);
      setTimeout(() => boxes.forEach(stopCurtain), SWAP_TOTAL_MS);
    }

    function clockIsB(){ return clockX.classList.contains("is-b"); }
    function clockFlip(){ clockX.classList.toggle("is-b"); }
    function setClockText(text){
      if (prefersReducedMotion){
        clockA.textContent = text;
        clockB.textContent = text;
        return;
      }
      if (clockIsB()){
        clockA.textContent = text;
      } else {
        clockB.textContent = text;
      }
      clockFlip();
    }

    function applyContent(langKey){
      const c = CONTENT[langKey];
      document.documentElement.setAttribute("lang", c.htmlLang);

      logoText.textContent = c.logo;
      descText.textContent = c.desc;
      contactLabel.textContent = open ? c.back : c.contact;

      setActiveButton(langKey);
      if (open && !prefersReducedMotion){
        restartUnderline();
      }
    }

    function pauseCyclingTemporarily(){
      if (resumeTimer) clearTimeout(resumeTimer);
      if (cycleTimer) { clearInterval(cycleTimer); cycleTimer = null; }
      resumeTimer = setTimeout(() => { if (open) startCycling(); }, MANUAL_PAUSE_MS);
    }

    function setLanguage(langKey, { fromCycle=false } = {}){
      if (!CONTENT[langKey] || langKey === currentLang) return;
      currentLang = langKey;

      curtainSwap([logoSwap, contactSwap, descSwap], () => {
        applyContent(langKey);
        setClockText(formatInTZ(new Date(), langKey));
      });

      if (!fromCycle && open) pauseCyclingTemporarily();
    }

    function setOpen(v){
      open = v;
      panel.classList.toggle("is-open", open);
      contactBtn.setAttribute("aria-expanded", String(open));

      const c = CONTENT[currentLang];
      contactLabel.textContent = open ? c.back : c.contact;

      if (open){
        if (!prefersReducedMotion) restartUnderline();
        startCycling();
      } else {
        langsEl.classList.remove("is-cycling");
        stopCycling(true);
      }
    }

    contactBtn.addEventListener("click", () => setOpen(!open));
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && open){
        setOpen(false);
        contactBtn.focus();
      }
    });

    function nextLang(){
      const idx = ORDER.indexOf(currentLang);
      const next = ORDER[(idx + 1) % ORDER.length];
      setLanguage(next, { fromCycle:true });
    }

    function startCycling(){
      if (prefersReducedMotion) return;
      if (cycleTimer) clearInterval(cycleTimer);
      if (resumeTimer) { clearTimeout(resumeTimer); resumeTimer = null; }

      langsEl.classList.add("is-cycling");
      restartUnderline();
      cycleTimer = setInterval(nextLang, CYCLE_MS);
    }

    function stopCycling(resetToEnglish){
      if (cycleTimer) { clearInterval(cycleTimer); cycleTimer = null; }
      if (resumeTimer) { clearTimeout(resumeTimer); resumeTimer = null; }
      langsEl.classList.remove("is-cycling");

      if (resetToEnglish){
        currentLang = "en";
        applyContent("en");
        setClockText(formatInTZ(new Date(), "en"));
      }
    }

    /* pause cycling when hovering over languages */
    langsEl.addEventListener("mouseenter", () => {
      if (cycleTimer) { clearInterval(cycleTimer); cycleTimer = null; }
    });
    langsEl.addEventListener("mouseleave", () => {
      if (open) startCycling();
    });

    langButtons.forEach(btn => {
      btn.addEventListener("click", () => setLanguage(btn.dataset.lang, { fromCycle:false }));
    });

    /* Init */
    applyContent("en");
    setClockText(formatInTZ(new Date(), "en"));

    /* Clock updates: every 10 seconds, gentle fade */
    setInterval(() => {
      setClockText(formatInTZ(new Date(), currentLang));
    }, 10000);
  </script>
</body>
</html>
